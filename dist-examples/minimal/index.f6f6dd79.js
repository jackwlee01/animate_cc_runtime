function t(t,e,a,s){Object.defineProperty(t,e,{get:a,set:s,enumerable:!0,configurable:!0})}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a={},s={},i=e.parcelRequire5443;null==i&&((i=function(t){if(t in a)return a[t].exports;if(t in s){var e=s[t];delete s[t];var i={id:t,exports:{}};return a[t]=i,e.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){s[t]=e},e.parcelRequire5443=i),i.register("8Ge4E",(function(e,a){t(e.exports,"Scene",(()=>r));var s=i("inlgY");class r{constructor(){this.draw=null,this.drawImage=null,this.pixelData={}}get mouseX(){throw"Override mouseX in base class"}get mouseY(){throw"Override mouseY in base class"}createLibrary(t,e){return new s.Library(t,e,this)}getPixelData(t){if(0==t.complete)throw"Image has not loaded!";const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const a=document.createElement("canvas").getContext("2d");a.drawImage(t,0,0);const s=a.getImageData(0,0,e.width,e.height);return{ctx:a,imageData:s,image:t}}}})),i.register("inlgY",(function(e,a){t(e.exports,"Library",(()=>c));var s=i("iwtVH"),r=i("fth7J"),n=i("7oRJk"),o=i("2xEof"),l=i("jvByp"),m=i("eU0bP"),h=i("dLlt9");class c{constructor(t,e,a){this.clips=[],this.clipsByName={},this.spritesByName={},this.atlases=[],this.atlasesBySpriteName={},this.name=t,this.path=e,this.atlases=[],this.scene=a}symbol(t){if(this.clipsByName[t])return this.clipsByName[t];if(this.spritesByName[t])return this.spritesByName[t];throw"Cannot find symbol: "+t+" for library: "+this.path}createAtlas(t,e){const a=new o.Atlas({...t,library:this,pixelData:e});return this.atlases.push(a),a}createSprite(t,e){const a=new n.Sprite({...e,atlas:t});return t.sprites.push(a),this.spritesByName[a.name]=a,this.atlasesBySpriteName[a.name]=t,a}createClip(t){const e=new s.Clip({...t,library:this});return this.clips.push(e),this.clipsByName[e.name]=e,e}async loadData(){const t=this.path+"/Animation.json",e=await fetch(t),a=await e.json(),s=l.normaliseJson(a),i=[];for(const t of s.symbolDictionary.symbols){const e=this.createClip({name:t.symbolName});for(let a=t.timeline.layers.length-1;a>=0;a--){const s=t.timeline.layers[a],n=e.createLayer({name:s.layerName,type:s.layerType||"Normal",clippedBy:s.clippedBy||null});for(const t of s.frames){const e=n.createFrame({name:""+t.index,totalFrames:t.duration,labelName:t.name,index:t.index});for(const a of t.elements)if("symbolInstance"in a){const t=a.symbolInstance,s=t.matrix3D,i={frame:e,name:e.name,filters:t.filters||null,matrix:"m00"in s?new m.Matrix(s.m00,s.m01,s.m02,s.m03,s.m10,s.m11,s.m12,s.m13,s.m20,s.m21,s.m22,s.m23,s.m30,s.m31,s.m32,s.m33):new m.Matrix(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15]),itemName:t.symbolName,color:t.color||null};e.createClipInstance({...i,transformationPoint:new r.Vec2(t.transformationPoint),behaviour:"graphic"==t.symbolType?{type:"graphic",loop:t.loop,firstFrame:t.firstFrame}:{type:"movieclip"}})}else{const t=a.atlasSpriteInstance,s=t.matrix3D,r=e.createSpriteInstance({name:e.name,filters:t.filters||null,color:null,matrix:"m00"in s?new m.Matrix(s.m00,s.m01,s.m02,s.m03,s.m10,s.m11,s.m12,s.m13,s.m20,s.m21,s.m22,s.m23,s.m30,s.m31,s.m32,s.m33):new m.Matrix(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15]),itemName:t.name});-1==i.indexOf(r.itemName)&&i.push(r.itemName)}}}}let n=1;for(const t of i)if(null==this.atlasesBySpriteName[t]){const t=this.path+`/spritemap${n}.json`,e=await fetch(t),a=await e.json(),s=l.normaliseJson(a),i=this.path+`/spritemap${n}.png`,r=await h.createImage(i),o=this.createAtlas({image:r,app:s.meta.app,version:s.meta.version,imagePath:s.meta.image,format:s.meta.format,size:s.meta.size,resolution:s.meta.resolution},this.scene.getPixelData(r));for(const t of s.atlas.sprites){const e=t.sprite,a=this.createSprite(o,{name:e.name,x:e.x,y:e.y,width:e.w,height:e.h,rotated:e.rotated});this.atlasesBySpriteName[a.name]=o}n++}}}})),i.register("iwtVH",(function(e,a){t(e.exports,"Clip",(()=>o));var s=i("ckyqm"),r=i("grEWN"),n=i("ixNXR");class o extends s.Drawable{constructor(t){super({...t,totalFrames:0,id:`${t.library.name}.clips.${t.name}`}),this.layers=[],this.layersById={},this.layersByName={},this.framesById={},this.framesByLabel={}}createLayer(t){const e=new r.Layer({...t,clip:this});return this.layers.push(e),this.layersById[e.id]=e,this.layersByName[e.name]=e,e.totalFrames>this.totalFrames&&(this.totalFrames=e.totalFrames),e}__addFrame(t){this.framesById[t.id]=t,t.layer.totalFrames>this.totalFrames&&(this.totalFrames=t.layer.totalFrames),t.labelName&&(this.framesByLabel[t.labelName]=t)}draw(t,e,a){for(const i of this.layers)if(0!=i.totalFrames){var s=n.modWrap(t,i.totalFrames);i.totalFrames>=s&&this.library.scene.draw(i,t,e,a)}}}})),i.register("ckyqm",(function(e,a){t(e.exports,"Drawable",(()=>s));class s{constructor(t){this.totalFrames=1,this.name=t.name,this.id=t.id,this.totalFrames=t.totalFrames,this.library=t.library}get scene(){return this.library.scene}draw(t,e,a){}}})),i.register("grEWN",(function(e,a){t(e.exports,"Layer",(()=>o));var s=i("ckyqm"),r=i("b16Gm"),n=i("ixNXR");class o extends s.Drawable{constructor(t){super({...t,totalFrames:0,id:`${t.clip.id}.${t.name}`,library:t.clip.library}),this.clip=t.clip,this.type=t.type,this.clippedBy=t.clippedBy||null,this.index=this.clip.layers.length,this.frames=[],this.framesByName={},this.labels=[]}createFrame(t){const e=new r.Frame({...t,layer:this});if(this.frames.length>0&&this.lastFrame.index+this.lastFrame.totalFrames!=e.index)throw"Must add next frame at previous frame.index+frame.duration";return this.framesByName[e.name]=e,e.index+e.totalFrames>this.totalFrames&&(this.totalFrames=e.index+e.totalFrames),e.labelName&&this.labels.push(e),this.clip.__addFrame(e),this.lastFrame&&(this.lastFrame.next=e,e.prev=this.lastFrame),this.frames.push(e),e}get lastFrame(){return this.frames[this.frames.length-1]}get firstFrame(){return this.frames[0]}keyframeAt(t){t=n.modWrap(t,this.totalFrames);for(const e of this.frames)if(e.index<=t&&e.index+e.totalFrames>t)return e;return null}draw(t,e,a){var s=this.keyframeAt(t);null!=s&&this.library.scene.draw(s,t,e,a)}}})),i.register("b16Gm",(function(e,a){t(e.exports,"Frame",(()=>o));var s=i("37DlR"),r=i("ckyqm"),n=i("1WBAd");class o extends r.Drawable{constructor(t){super({...t,id:`${t.layer.id}.${t.index}`,library:t.layer.library}),this.instances=[],this.layer=t.layer,this.index=t.index,this.labelName=t.labelName||null}createClipInstance(t){const e=new s.ClipInstance({...t,frame:this,totalFrames:this.totalFrames});return this.instances.push(e),e}createSpriteInstance(t){const e=new n.SpriteInstance({...t,frame:this,totalFrames:this.totalFrames});return this.instances.push(e),e}draw(t,e,a){for(const s of this.instances)this.library.scene.draw(s,t,e,a)}}})),i.register("37DlR",(function(e,a){t(e.exports,"ClipInstance",(()=>o));var s=i("fth7J"),r=i("aIUQE"),n=i("ixNXR");class o extends r.Instance{constructor(t){super(t),this.behaviour=t.behaviour||{type:"movieclip"},this.transformationPoint=t.transformationPoint||new s.Vec2({x:0,y:0})}get item(){return this.library.clipsByName[this.itemName]}draw(t,e,a){"graphic"==this.behaviour.type&&(t=this.behaviour.firstFrame+n.modWrap(t,1)),this.library.scene.draw(this.item,t,e,a)}}})),i.register("fth7J",(function(e,a){t(e.exports,"Vec2",(()=>s));class s{constructor(t){this.x=t.x,this.y=t.y,this.data=new Float32Array([this.x,this.y])}}})),i.register("aIUQE",(function(e,a){t(e.exports,"Instance",(()=>n));var s=i("ckyqm"),r=i("eU0bP");class n extends s.Drawable{constructor(t){super({...t,library:t.frame.library,id:`${t.frame.id}.${t.frame.instances.length}`}),this.itemName=t.itemName,this.matrix=t.matrix||new r.Matrix(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this.filters=t.filters||null,this.color=t.color||null,this.frame=t.frame,this.index=this.frame.instances.length}get prev(){const t=this.frame.prev?.instances[this.index];return t?.itemName==this.itemName?t:void 0}get next(){const t=this.frame.next?.instances[this.index];return t?.itemName==this.itemName?t:void 0}get item(){throw"Override item getter in base class"}draw(t,e,a){this.library.scene.draw(this.item,t,e,a)}}})),i.register("eU0bP",(function(e,a){t(e.exports,"Matrix",(()=>s));class s{constructor(t,e,a,s,i,r,n,o,l,m,h,c,p,y,d,f){this._00=t,this._01=e,this._02=a,this._03=s,this._10=i,this._11=r,this._12=n,this._13=o,this._20=l,this._21=m,this._22=h,this._23=c,this._30=p,this._31=y,this._32=d,this._33=f,this.data=new Float32Array([t,e,a,s,i,r,n,o,l,m,h,c,p,y,d,f])}}})),i.register("ixNXR",(function(e,a){function s(t,e){return t-e*Math.floor(t/e)}t(e.exports,"modWrap",(()=>s))})),i.register("1WBAd",(function(e,a){t(e.exports,"SpriteInstance",(()=>r));var s=i("aIUQE");class r extends s.Instance{constructor(t){super(t)}get item(){return this.library.spritesByName[this.itemName]}}})),i.register("7oRJk",(function(e,a){t(e.exports,"Sprite",(()=>r));var s=i("ckyqm");class r extends s.Drawable{constructor(t){super({...t,totalFrames:1,library:t.atlas.library,id:`${t.atlas.library.name}.sprites.${t.name}`}),this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.rotated=t.rotated,this.atlas=t.atlas}getPixel(t,e,a){const s=new DOMPoint(t,e),i=a.inverse(),r=s.matrixTransform(i);return r.x<0||r.x>=this.width||r.y<0||r.y>=this.height?null:this.atlas.getPixel(this.x+r.x,this.y+r.y)}isSolidPixelAt(t,e,a,s=1){const i=this.getPixel(t,e,a);return i&&i[3]>s}draw(t,e,a){this.scene.drawImage(this.atlas.image,this.x,this.y,this.width,this.height,0,0,this.width,this.height)}}})),i.register("2xEof",(function(e,a){t(e.exports,"Atlas",(()=>s));class s{constructor(t){this.sprites=[],this.library=t.library,this.image=t.image,this.app=t.app,this.version=t.version,this.imagePath=t.imagePath,this.format=t.format,this.size=t.size,this.resolution=t.resolution,this.pixelData=t.pixelData}getPixel(t,e){let a=(t=Math.floor(t))+(e=Math.floor(e))*this.pixelData.imageData.width;const s=this.pixelData.imageData.data;return[s[4*a+0],s[4*a+1],s[4*a+2],s[4*a+3]]}}})),i.register("jvByp",(function(e,a){t(e.exports,"normaliseJson",(()=>i));const s={SPRITE:"sprite",SPRITES:"sprites",ATLAS:"atlas",ANIMATION:"animation",ATLAS_SPRITE_instance:"atlasSpriteInstance",DecomposedMatrix:"decomposedMatrix",Frames:"frames",framerate:"frameRate",Instance_Name:"instanceName",Layer_name:"layerName",Layer_type:"layerType",Clipped_by:"clippedBy",LAYERS:"layers",Matrix3D:"matrix3D",Position:"position",Rotation:"rotation",Scaling:"scaling",SYMBOL_DICTIONARY:"symbolDictionary",SYMBOL_Instance:"symbolInstance",SYMBOL_name:"symbolName",Symbols:"symbols",TIMELINE:"timeline",GradientEntries:"gradientEntries",RedMultiplier:"redMultiplier",AlphaOffset:"alphaOffset",AN:"animation",AM:"alphaMultiplier",ASI:"atlasSpriteInstance",BM:"bitmap",C:"color",DU:"duration",E:"elements",FF:"firstFrame",FR:"frames",FRT:"frameRate",I:"index",IN:"instanceName",L:"layers",LN:"layerName",LP:"loop",M3D:"matrix3D",MD:"metadata",M:"mode",N:"name",POS:"position",S:"symbols",SD:"symbolDictionary",SI:"symbolInstance",SN:"symbolName",ST:"symbolType",TL:"timeline",TRP:"transformationPoint"};function i(t){if("string"==typeof t||"number"==typeof t)return t;switch(typeof t){case"string":case"number":case"boolean":return t;case"object":if(Array.isArray(t))return t.map(i);var e={};return Object.keys(t).forEach((a=>e[function(t){return s[t]||t}(a)]=i(t[a]))),e;case"bigint":case"function":case"symbol":case"undefined":throw"Not supported";default:throw"Unsupported"}}})),i.register("dLlt9",(function(e,a){t(e.exports,"createImage",(()=>s));const s=t=>new Promise((e=>{const a=new Image;a.src=t,a.onload=()=>e(a),a.onerror=()=>{throw"Image did not load: "+a.src}}))}));
//# sourceMappingURL=index.f6f6dd79.js.map
